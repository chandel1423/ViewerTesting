<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Multi-viewer Interface</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script type="text/javascript" src="https://cesium.com/downloads/cesiumjs/releases/1.89/Build/Cesium/Cesium.js"></script>
  <link type="text/css" href="https://cesium.com/downloads/cesiumjs/releases/1.89/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <link type="text/css" href="css/ui-lightness/jquery-ui-1.10.3.custom.css" rel="Stylesheet">
  <link type="text/css" href="css/webrtiviewer.css" rel="Stylesheet">
  <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="js/jquery-ui.min.js"></script>
  <script type="text/javascript" src="js/pep.min.js"></script>
  <script type="text/javascript" src="spidergl/spidergl.min.js"></script>
  <script type="text/javascript" src="spidergl/multires.min.js"></script>
  <script type="text/javascript" src="main.js"></script>
  <link type="text/css" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.min.css" rel="stylesheet">
  <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.min.js"></script>
<style> 
  html { 
    overflow-y: visible; 
    overflow-x: visible; 
  }
  body { 
    position: absolute; 
  }
  #togglebuttons {
    margin-bottom: 20px;
  }
  #blankAlert {
    display: none
  }
  #cesiumContainer {
    float: left;
    margin-right: 3vw;
    width:90vw; height:80vh;
  }
  #rtiContainer { 
    float: left;
    margin-right: 3vw;
    width:90vw; height:80vh;
  }
  #dwgContainer { 
    float: left;
    margin-right: 3vw;
    width:90vw; height:80vh;
  }
</style>
</head>

<body>
  <div id="togglebuttons">
    <!--Buttons to toggle viewers on and off-->
    <button onclick="viewertoggle(cesiumContainer)" style="background-color:lightgreen">Cesium Ion</button>
    <button onclick="viewertoggle(rtiContainer)" style="background-color:coral">RTI Viewer</button>
    <button onclick="viewertoggle(dwgContainer)" style="background-color:lightblue">DWG File Viewer</button>
  </div>

  <div id="blankAlert">
    <!--Something to show when there is no viewer turned on-->
    Please choose a viewer to start from. (0.16)
  </div>

  <div id="cesiumContainer">
    <script>
    // Access token for Cesium Ion (currently this is using SeYoon Park's access token)
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJlNjQ1NTgwOS1hM2QzLTQ1Y2QtOWE5Zi1jODc1ZTJjNDkxODEiLCJpZCI6NzkyNDQsImlhdCI6MTY0MTkzMTc3NH0.AmCqPPV7p3Oldv_Vk-WrBPm_NwkhpTxgZWZaqWnI-pE';
    // Create Cesium viewer with only the model
    // Cesium JS (https://cesium.com/platform/cesiumjs/)
    const cesiumViewer = new Cesium.Viewer('cesiumContainer', {
        globe: false,
        animation: false,
        timeline: false,
        skyBox: false,
    });    
    var scene = cesiumViewer.scene;
    scene.backgroundColor = Cesium.Color.BLACK.clone();
    // Fix the camera to the bounding sphere of the model
    const tileset = cesiumViewer.scene.primitives.add(
        new Cesium.Cesium3DTileset({
        url: Cesium.IonResource.fromAssetId(755017),
      })
    );
    tileset.readyPromise.then(function(tileset) {
    cesiumViewer.camera.viewBoundingSphere(tileset.boundingSphere, new Cesium.HeadingPitchRange(0, -0.5, 0));
    });
    </script>
    <div>
      <button type="button" class="cesium-button" onclick = "topView();" data-toggle="tooltip" data-placement="bottom" 
        title="Click to view the model from the top">Top View</button>
      <button type="button" class="cesium-button" onclick = "bottomView();" data-toggle="tooltip" data-placement="bottom" 
        title="Click to view the model from the bottom">Bottom View</button>
      <button type="button" class="cesium-button" onclick = "frontView();" data-toggle="tooltip" data-placement="bottom" 
        title="Click to view the model from the front side">Front View</button>
    </div>
    <script>
      // Make functions that changes the view point in Cesium viewer
      function topView() {
          cesiumViewer.camera.viewBoundingSphere(tileset.boundingSphere, new Cesium.HeadingPitchRange(0, -Cesium.Math.PI_OVER_TWO, 0));
      }
      function bottomView() {
          cesiumViewer.camera.viewBoundingSphere(tileset.boundingSphere, new Cesium.HeadingPitchRange(0, Cesium.Math.PI_OVER_TWO, 0));
      }
      function frontView() {
          cesiumViewer.camera.viewBoundingSphere(tileset.boundingSphere, new Cesium.HeadingPitchRange(0, 0, 0));
      }
    </script>
  </div>

  <div id="rtiContainer">
    <script>
      // Create web RTI viewer
      // Web RTI Viewer from Visual Computing Lab in ISTI (http://vcg.isti.cnr.it/rti/webviewer.php)
      function showRTI() {
        createRtiViewer('rtiContainer', "webrti", document.getElementById('rtiContainer').clientWidth, document.getElementById('rtiContainer').clientHeight); 
      }
    </script>
    <button type="button" class="rti-button" data-toggle="tooltip" data-placement="bottom" 
      title="sample button 1">button 1</button>
    <button type="button" class="rti-button" data-toggle="tooltip" data-placement="bottom" 
      title="sample button 2">button 2</button>
  </div>

  <div id="dwgContainer">
    <script>
      // Create .dwg file viewer
      // Autodesk Forge Viewer (https://forge.autodesk.com/en/docs/viewer/v7/developers_guide/overview/)
      var dwgViewer;
        var options = {
            env: 'AutodeskProduction',
            api: 'streamingV2',
            getAccessToken: function(onTokenReady) {
              var token = 'eyJhbGciOiJSUzI1NiIsImtpZCI6IlU3c0dGRldUTzlBekNhSzBqZURRM2dQZXBURVdWN2VhIn0.eyJzY29wZSI6WyJkYXRhOnJlYWQiXSwiY2xpZW50X2lkIjoiVEYyempaZVlTVUc4TElOMHBad0tRTzFUSGJOcTdaZUMiLCJhdWQiOiJodHRwczovL2F1dG9kZXNrLmNvbS9hdWQvYWp3dGV4cDYwIiwianRpIjoiZE5OYWI1NmlYMGNGam9GZHBPSmpsWXJPVVhGZGx3aDJWTE9hbVdJcGUxQUtRSXdQSm9naHNPU3A4bFpiUkQ0OSIsImV4cCI6MTY1MTY1NDIyM30.e0HND5TN1Rk8CZZYaew2SRDxbyqsSrvpURwfjKDTnoSC81KZbhZbSbgr2QaKOkMvtFMtvJUFa3ZsJdSP8fTKTVI21HbB7cv1rcRRxE1GunSQA9KkP4kprxc7Zs6lP053EtPETuWtYPb7AZootqiCWcfR2j5pnjsv48EPb0UTE_zWKdNCJdCOanI__zndjpgfcCT2kVrq1AAU5sFgW32nYxdjBq_1iT03AZKYsQlZYnVcAjwIGKHRjuwxCmK1ITuaFB5q0sJ_CyKp1LJtajIHl7vZ0u0-rxtLta-TKVI8rQXRnXLbwBhMYwZWPc88s-_oz50sLRdvKhJJdTZ6kL0pCA';
              var timeInSeconds = 3600;
              onTokenReady(token, timeInSeconds);
            }
        };
      // Initializing Autodesk Forge Viewer
      Autodesk.Viewing.Initializer(options, function() {
        var htmlDiv = document.getElementById('dwgContainer');
        dwgViewer = new Autodesk.Viewing.GuiViewer3D(htmlDiv);
        var startedCode = dwgViewer.start();
        if (startedCode > 0) {
          console.error('falied to create a viewer: WebGL not supported');
          return;
        }
        console.log('Initialization complete, loading a model next...');
      document.getElementById('adsk-viewing-viewer notouch dark-theme quality-text').style.width = document.getElementById('dwgContainer').style.width;  
      document.getElementById('adsk-viewing-viewer notouch dark-theme quality-text').style.height = document.getElementById('dwgContainer').style.height;  
      });
    </script>
    <button type="button" class="rti-button" data-toggle="tooltip" data-placement="bottom" 
      title="sample button 1">button 1</button>
    <button type="button" class="rti-button" data-toggle="tooltip" data-placement="bottom" 
      title="sample button 2">button 2</button>
  </div>

  <script>
    // Script for changing the width for each viewer based on number of viewers turned on
    var togglecount = 1;
    cesiumContainer.style.display = 'block';
    rtiContainer.style.display = 'none';
    dwgContainer.style.display = 'none';
    function changewidth() {
      changedWidth = (90-3*(togglecount-1))/togglecount;
      cesiumContainer.style.width = changedWidth+'vw';
      rtiContainer.style.width = changedWidth+'vw';
      showRTI();
      dwgContainer.style.width = changedWidth+'vw';
    }
    // Function for turning each viewer on and off when pressing the corresponding button
    function viewertoggle(x) {
      if (x.style.display == 'none') {
        x.style.display = 'block';
        togglecount = togglecount + 1;
      }
      else {
        x.style.display = 'none';
        togglecount = togglecount - 1;
      }
      if (togglecount == 0) {
        // Displays the alert message when there is no viewer turned on
        blankAlert.style.display = 'block';
      }
      else {
        // Hides the alert message and changes the width of each viewer
        blankAlert.style.display = 'none';
        changewidth();
      }
    }
  </script>    
</body>
</html>